function findRedirection(e,t){response=JSON.parse(e.responseText);if(response.redirect=="login"){window.location.href="/login/?next=/guideline/"+t;return true}if(response.invalid_user){window.alert("You can't vote on your own convention");return true}return false}$(document).ready(function(){function n(e,t){$("#left-cross-input").val(e);$("#right-cross-input").val(t);$("#cross-form").submit()}function i(e,t,n){$.ajax({type:"POST",url:"/toggle_favorite/",data:{convention_id:e,favorite:true,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},dataType:"json",beforeSend:function(){$("div.fav-buttons").unbind("click")},success:function(i,s,o){i=s=null;$("div.fav-buttons").bind("click",r);if(n=="on"){if(!findRedirection(o,e)){t.removeAttr("src").attr("src",static_path+"fav_off.png").addClass("fav").removeClass("fav-selected")}t.removeAttr("src").attr("src",static_path+"fav_on.png").removeClass("fav").addClass("fav-selected")}else{if(!findRedirection(o,e)){t.removeAttr("src").attr("src",static_path+"fav_off.png").addClass("fav").removeClass("fav-selected")}}}})}function f(e,t,n,r){$.ajax({type:"POST",url:"/toggle_comment_vote/",data:{comment_id:e,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},dataType:"json",beforeSend:function(){$(".comment-increment").unbind("click")},success:function(e,i,s){e=i=null;$(".comment-increment").bind("click",a);response=JSON.parse(s.responseText);if(response.invalid_user){window.alert("You can't vote on your own convention")}else{if(t.hasClass("selected")){t.removeAttr("src").attr("src",static_path+"up"+"_off.png").removeClass("selected");var o=parseInt(n)-1;r.html(o)}else{t.removeAttr("src").attr("src",static_path+"up"+"_on.png").addClass("selected");var o=parseInt(n)+1;r.html(o)}}},error:function(e,t,n){console.log("error")}})}function l(e,t,n,r,i,s,o){var a=t===true?"up":"down";var f=t===true?"down":"up";$.ajax({type:"POST",url:"/toggle_vote/",data:{convention_id:e,up_vote:t,down_vote:n,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},dataType:"json",beforeSend:function(){$(".votes").unbind("click")},success:function(n,l,c){n=l=null;$(".votes").bind("click",u);if(r.hasClass("selected")){r.removeAttr("src").attr("src",static_path+a+"_off.png").removeClass("selected");var h=i.hasClass("selected")?2:1;var p=t?parseInt(s)-parseInt(h):parseInt(s)+parseInt(h);if(p>0){p="+"+p}o.html(p);i.removeAttr("src").attr("src",static_path+f+"_off.png").removeClass("selected")}else{if(!findRedirection(c,e)){r.removeAttr("src").attr("src",static_path+a+"_on.png").addClass("selected");var d=i.hasClass("selected")?2:1;var v=t?parseInt(s)+parseInt(d):parseInt(s)-parseInt(d);if(v>0){v="+"+v}o.html(v);i.removeAttr("src").attr("src",static_path+f+"_off.png").removeClass("selected")}}},error:function(e,t,n){}})}$(".link-nolink").bind("click",function(){var e=$(this).attr("name").split(",");var t=e[1];$("#update-"+t).show();$("#delete-"+t).hide()});$(".link-nolink-cancel").bind("click",function(){var e=$(this).attr("name").split(",");var t=e[1];$("#update-"+t).hide();$("#delete-"+t).show()});$(".link-nolink").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$(".link-nolink-cancel").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$("#post-new-convention").bind("click",function(){$(this).hide()});$("#share").bind("click",function(){if($("#sharebox").is(":visible")){$("#sharebox").hide()}else{$("#sharebox").show();$("#sharebox").children().select();$("#duplicatebox").hide()}});$("#duplicate").bind("click",function(){if($("#duplicatebox").is(":visible")){$("#duplicatebox").hide()}else{$("#duplicatebox").show();$("#sharebox").hide()}});$("#duplicate").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$("#cancel-duplicate").bind("click",function(){$("#duplicatebox").hide()});$("#share").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$(".similar-circle").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$("#welcome-form").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$(".post-button").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$("#signup-link-form").hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")});$("#notification-base").hover(function(){$("#notification-alert").css("background","#aaa");$(this).css("cursor","pointer")},function(){$("#notification-alert").css("background","#777");$(this).css("cursor","auto")});$("#notification-base").bind("click",function(){var e=$(this).attr("value");var t=e.split(",");var n=t[0];window.location.href="/user/notifications/"+n+"/"});$(".similar-circle").bind("click",function(){var e=$(this).attr("name");window.location.href="/guidelines/"+e+"/similar"});$("#delete-account").bind("click",function(){var e=confirm("Do you really want to delete your account?");var t=$(this).attr("name");var n="/user/edit/"+t+"/";if(e==true){$.ajax({type:"POST",url:n,data:{"delete":true,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(){window.location.href="/"}})}});$("#logo-blog-pro").mouseover(function(){$(this).fadeTo("fast",.75);$(this).css("cursor","pointer")}).mouseout(function(){var e=$(this);e.fadeTo("fast",1);$(this).css("cursor","auto")}).bind("click",function(){window.location.href="/blog"});$("#logo-pro").mouseover(function(){$(this).attr("src",static_path+"logo-blue.svg");$(this).css("cursor","pointer")}).mouseout(function(){var e=$(this).attr("src").replace("logo-blue.svg","logo.svg");$(this).attr("src",e);$(this).css("cursor","auto")}).bind("click",function(){window.location.href="/"});$(".left-add-standard").mouseover(function(){$(this).css("background","#7bd95a");$(this).css("cursor","pointer")}).mouseout(function(){$(this).css("background","#79d858");$(this).css({background:"-webkit-gradient(linear, left top, left bottom, from(#7bd95a), to(#5fa547))"}).css({background:"-moz-linear-gradient(top, #7bd95a, #5fa547)"}).css({});$(this).css("cursor","auto")}).bind("click",function(){window.location.href="/post/guideline/"});if($("#signup-error-message").val()){$("#signup-form").show();$("#signup-manually").hide()}$("#signup-link-form").bind("click",function(){if($("#signup-form").is(":visible")){$("#signup-form").show()}else{$("#signup-form").show();$("#signup-manually").hide()}});$("#unique-duplicate").bind("click",function(){if($("#guideline-duplicated-founded").html()){$.ajax({type:"POST",url:"/duplicate/",data:{duplicate_guide:$("#duplicate-input").val(),current_guide:$("#duplicate-input").attr("name"),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e,t,n){response=JSON.parse(n.responseText);window.alert(response.message);window.location.href="/s/"+$("#duplicate-input").attr("name")},error:function(e,t,n){$("#duplicatebox").hide()},dataType:"html"})}else{window.alert("Sorry! But we can't find the id you are tagging.")}});$("#duplicate-input").keyup(function(e){$.ajax({type:"POST",url:"/search_duplicate/",data:{perma_id:$("#duplicate-input").val(),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e,t,n){var r=JSON.parse(n.responseText);$("#guideline-duplicated-founded").html("");var i=r.votes;if(parseInt(i)>0){i="+"+i}if(r.style){var s=r.style+" in "+r.tag+"<br/>"+i+" votes"+" by "+r.author+" on "+r.date;$("#guideline-duplicated-founded").html(s)}},error:function(e,t,n){$("#guideline-duplicated-founded").html("")},dataType:"html"})});$("#search").keydown(function(e){if(e.keyCode==13){$.ajax({type:"GET",url:"/search/",data:{text:$("#search").val(),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(){window.location.href="/search/?text="+encodeURIComponent($("#search").val())},dataType:"html"})}});$("#search").focus(function(){$(this).attr("data-default",$(this).width());$(this).animate({width:315},"fast");$(".topbar-left-menu").fadeOut(70)}).blur(function(){var e=$(this).attr("data-default");$(this).animate({width:e},"fast");$(".topbar-left-menu").fadeIn(700)});$(function(){$("pre").addClass("prettyprint");$("code").addClass("prettyprint");$("pre").css({border:"none"})});if($("#cross-navigation-menu").is(":visible")){$("#leftmenu").hide()}else{$("#leftmenu").show()}$("#popup-login").mouseover(function(){$("#dialog1").dialog({autoOpen:false,modal:true,dialogClass:"dlg-no-close"})});var e=$("#left-cross-select option:selected").val();var t=$("#right-cross-select option:selected").val();$("#left-cross-select").on("change",function(){e=$("option:selected",$(this));n(e.val(),t)});$("#right-cross-select").on("change",function(){t=$("option:selected",$(this));n(e,t.val())});var r=function(){var e=$("img",$(this));var t=$('input[name="convention_id"]',$(this)).val();if(e.hasClass("fav")){i(t,e,"on")}else{i(t,e,"off")}};$(".fav, .fav-selected").css("cursor","pointer");$("div.fav-buttons").on("click",r);var s=10;var o=40;var u=function(e){var t=$('input[name="convention_id"]',$(this)).val();var n=t.split(",");convention_id=n[0];user_reputation=n[1];var r=$(".vote-count",$(this)).html();var i=$(".vote-count",$(this));var u=e.target.className;if(u=="vote-up selected"||u=="vote-up"){if(user_reputation<s){window.alert("Sorry but you need at least "+s+" reputation pts to vote up.")}else{var a=$("img.vote-up",$(this));var f=$("img.vote-down",$(this));l(convention_id,true,false,a,f,r,i)}}else if(u=="vote-down selected"||u=="vote-down"){if(user_reputation<o){window.alert("Sorry but you need at least "+o+" reputation pts to vote down.")}else{var c=$("img.vote-down",$(this));var h=$("img.vote-up",$(this));l(convention_id,false,true,c,h,r,i)}}};var a=function(e){var t=$('input[name="comment_id"]',$(this)).val();var n=$("img.vote-comment-up",$(this));var r=$(".vote-comment-count",$(this)).html();var i=$(".vote-comment-count",$(this));f(t,n,r,i)};$(".vote-comment-up").css("cursor","pointer");$(".comment-increment").on("click",a);$(".vote-up, .vote-down").css("cursor","pointer");$(".votes").on("click",u)})
